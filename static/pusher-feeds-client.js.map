{"version":3,"file":"pusher-feeds-client.js","sources":["../node_modules/pusher-platform-js/target/pusher-platform.js","../src/constants.js","../src/utils.js","../src/feed.js","../src/feeds-authorizer.js","../src/pusher-feeds.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PusherPlatform\"] = factory();\n\telse\n\t\troot[\"PusherPlatform\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 4);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar subscription_1 = __webpack_require__(1);\nvar resumable_subscription_1 = __webpack_require__(2);\nfunction responseHeadersObj(headerStr) {\n    var headers = {};\n    if (!headerStr) {\n        return headers;\n    }\n    var headerPairs = headerStr.split('\\u000d\\u000a');\n    for (var i = 0; i < headerPairs.length; i++) {\n        var headerPair = headerPairs[i];\n        var index = headerPair.indexOf('\\u003a\\u0020');\n        if (index > 0) {\n            var key = headerPair.substring(0, index);\n            var val = headerPair.substring(index + 2);\n            headers[key] = val;\n        }\n    }\n    return headers;\n}\nexports.responseHeadersObj = responseHeadersObj;\nvar ErrorResponse = (function () {\n    function ErrorResponse(xhr) {\n        this.statusCode = xhr.status;\n        this.headers = responseHeadersObj(xhr.getAllResponseHeaders());\n        this.info = xhr.responseText;\n    }\n    return ErrorResponse;\n}());\nexports.ErrorResponse = ErrorResponse;\n// Follows https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState\nvar XhrReadyState;\n(function (XhrReadyState) {\n    XhrReadyState[XhrReadyState[\"UNSENT\"] = 0] = \"UNSENT\";\n    XhrReadyState[XhrReadyState[\"OPENED\"] = 1] = \"OPENED\";\n    XhrReadyState[XhrReadyState[\"HEADERS_RECEIVED\"] = 2] = \"HEADERS_RECEIVED\";\n    XhrReadyState[XhrReadyState[\"LOADING\"] = 3] = \"LOADING\";\n    XhrReadyState[XhrReadyState[\"DONE\"] = 4] = \"DONE\";\n})(XhrReadyState = exports.XhrReadyState || (exports.XhrReadyState = {}));\nvar BaseClient = (function () {\n    function BaseClient(options) {\n        this.options = options;\n        var cluster = options.cluster.replace(/\\/$/, '');\n        this.baseURL = (options.encrypted !== false ? \"https\" : \"http\") + \"://\" + cluster;\n        this.XMLHttpRequest = options.XMLHttpRequest || window.XMLHttpRequest;\n    }\n    BaseClient.prototype.request = function (options) {\n        var xhr = this.createXHR(this.baseURL, options);\n        return new Promise(function (resolve, reject) {\n            xhr.onreadystatechange = function () {\n                if (xhr.readyState === 4) {\n                    if (xhr.status === 200) {\n                        resolve(xhr.responseText);\n                    }\n                    else {\n                        reject(new ErrorResponse(xhr));\n                    }\n                }\n            };\n            xhr.send(JSON.stringify(options.body));\n        });\n    };\n    BaseClient.prototype.newSubscription = function (subOptions) {\n        return new subscription_1.Subscription(this.createXHR(this.baseURL, {\n            method: \"SUBSCRIBE\",\n            path: subOptions.path,\n            headers: {},\n            body: null,\n        }), subOptions);\n    };\n    BaseClient.prototype.newResumableSubscription = function (subOptions) {\n        var _this = this;\n        return new resumable_subscription_1.ResumableSubscription(function () {\n            return _this.createXHR(_this.baseURL, {\n                method: \"SUBSCRIBE\",\n                path: subOptions.path,\n                headers: {},\n                body: null,\n            });\n        }, subOptions);\n    };\n    BaseClient.prototype.createXHR = function (baseURL, options) {\n        var XMLHttpRequest = this.XMLHttpRequest;\n        var xhr = new XMLHttpRequest();\n        var path = options.path.replace(/^\\/+/, \"\");\n        var endpoint = baseURL + \"/\" + path;\n        xhr.open(options.method.toUpperCase(), endpoint, true);\n        if (options.body) {\n            xhr.setRequestHeader(\"content-type\", \"application/json\");\n        }\n        if (options.jwt) {\n            xhr.setRequestHeader(\"authorization\", \"Bearer \" + options.jwt);\n        }\n        for (var key in options.headers) {\n            xhr.setRequestHeader(key, options.headers[key]);\n        }\n        return xhr;\n    };\n    return BaseClient;\n}());\nexports.BaseClient = BaseClient;\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_client_1 = __webpack_require__(0);\nvar SubscriptionState;\n(function (SubscriptionState) {\n    SubscriptionState[SubscriptionState[\"UNOPENED\"] = 0] = \"UNOPENED\";\n    SubscriptionState[SubscriptionState[\"OPENING\"] = 1] = \"OPENING\";\n    SubscriptionState[SubscriptionState[\"OPEN\"] = 2] = \"OPEN\";\n    SubscriptionState[SubscriptionState[\"ENDING\"] = 3] = \"ENDING\";\n    SubscriptionState[SubscriptionState[\"ENDED\"] = 4] = \"ENDED\"; // called onEnd() or onError(err)\n})(SubscriptionState = exports.SubscriptionState || (exports.SubscriptionState = {}));\n// Asserts that the subscription state is one of the specified values,\n// otherwise logs the current value.\nfunction assertState(stateEnum, states) {\n    var _this = this;\n    if (states === void 0) { states = []; }\n    var check = states.some(function (state) { return stateEnum[state] === _this.state; });\n    var expected = states.join(', ');\n    var actual = stateEnum[this.state];\n    console.assert(check, \"Expected this.state to be \" + expected + \" but it is \" + actual);\n    if (!check) {\n        console.trace();\n    }\n}\nexports.assertState = assertState;\n;\n// Callback pattern: (onOpen onEvent* (onEnd|onError)) | onError\n// A call to `unsubscribe()` will call `options.onEnd()`;\n// a call to `unsubscribe(someError)` will call `options.onError(someError)`.\nvar Subscription = (function () {\n    function Subscription(xhr, options) {\n        var _this = this;\n        this.xhr = xhr;\n        this.options = options;\n        this.state = SubscriptionState.UNOPENED;\n        this.gotEOS = false;\n        this.lastNewlineIndex = 0;\n        this.assertState = assertState.bind(this, SubscriptionState);\n        if (options.lastEventId) {\n            this.xhr.setRequestHeader(\"Last-Event-Id\", options.lastEventId);\n        }\n        this.xhr.onreadystatechange = function () {\n            if (_this.xhr.readyState === base_client_1.XhrReadyState.UNSENT ||\n                _this.xhr.readyState === base_client_1.XhrReadyState.OPENED ||\n                _this.xhr.readyState === base_client_1.XhrReadyState.HEADERS_RECEIVED) {\n                // Too early for us to do anything.\n                _this.assertState(['OPENING']);\n            }\n            else if (_this.xhr.readyState === base_client_1.XhrReadyState.LOADING) {\n                // The headers have loaded and we have partial body text.\n                // We can get this one multiple times.\n                _this.assertState(['OPENING', 'OPEN', 'ENDING']);\n                if (_this.xhr.status === 200) {\n                    // We've received a successful response header.\n                    // The partial body text is a partial JSON message stream.\n                    if (_this.state === SubscriptionState.OPENING) {\n                        _this.state = SubscriptionState.OPEN;\n                        if (_this.options.onOpen) {\n                            _this.options.onOpen();\n                        }\n                    }\n                    _this.assertState(['OPEN', 'ENDING']);\n                    var err = _this.onChunk(); // might transition our state from OPEN -> ENDING\n                    _this.assertState(['OPEN', 'ENDING']);\n                    if (err != null) {\n                        _this.xhr.abort();\n                        // Because we abort()ed, we will get no more calls to our onreadystatechange handler,\n                        // and so we will not call the event handler again.\n                        // Finish with options.onError instead of the options.onEnd.\n                        _this.state = SubscriptionState.ENDED;\n                        if (_this.options.onError) {\n                            _this.options.onError(err);\n                        }\n                    }\n                    else {\n                        // We consumed some response text, and all's fine. We expect more text.\n                    }\n                }\n                else {\n                    // Error response. Wait until the response completes (state 4) before erroring.\n                    _this.assertState(['OPENING']);\n                }\n            }\n            else if (_this.xhr.readyState === base_client_1.XhrReadyState.DONE) {\n                // This is the last time onreadystatechange is called.\n                if (_this.xhr.status === 200) {\n                    if (_this.state === SubscriptionState.OPENING) {\n                        _this.state = SubscriptionState.OPEN;\n                        if (_this.options.onOpen) {\n                            _this.options.onOpen();\n                        }\n                    }\n                    _this.assertState(['OPEN', 'ENDING']);\n                    var err = _this.onChunk();\n                    if (err !== null && err !== undefined) {\n                        _this.state = SubscriptionState.ENDED;\n                        if (_this.options.onError) {\n                            _this.options.onError(err);\n                        }\n                    }\n                    else if (_this.state !== SubscriptionState.ENDING) {\n                        if (_this.options.onError) {\n                            _this.options.onError(new Error(\"HTTP response ended without receiving EOS message\"));\n                        }\n                    }\n                    else {\n                        // Stream ended normally.\n                        if (_this.options.onEnd) {\n                            _this.options.onEnd();\n                        }\n                    }\n                }\n                else {\n                    // The server responded with a bad status code (finish with onError).\n                    // Finish with an error.\n                    _this.assertState(['OPENING', 'OPEN', 'ENDED']);\n                    if (_this.state === SubscriptionState.ENDED) {\n                        // We aborted the request deliberately, and called onError/onEnd elsewhere.\n                    }\n                    else {\n                        // The server\n                        if (_this.options.onError) {\n                            _this.options.onError(new Error(\"error from server: \" + _this.xhr.responseText));\n                        }\n                    }\n                }\n            }\n        };\n        xhr.onerror = function () {\n            if (_this.options.onError) {\n                _this.options.onError(new Error(\"resumable\"));\n            }\n        };\n    }\n    Subscription.prototype.open = function (jwt) {\n        if (this.state !== SubscriptionState.UNOPENED) {\n            throw new Error(\"Called .open() on Subscription object in unexpected state: \" + this.state);\n        }\n        this.state = SubscriptionState.OPENING;\n        if (jwt) {\n            this.xhr.setRequestHeader(\"authorization\", \"Bearer \" + jwt);\n        }\n        this.xhr.send();\n    };\n    // calls options.onEvent 0+ times, then possibly returns an error.\n    // idempotent.\n    Subscription.prototype.onChunk = function () {\n        this.assertState(['OPEN']);\n        var response = this.xhr.responseText;\n        var newlineIndex = response.lastIndexOf(\"\\n\");\n        if (newlineIndex > this.lastNewlineIndex) {\n            var rawEvents = response.slice(this.lastNewlineIndex, newlineIndex).split(\"\\n\");\n            this.lastNewlineIndex = newlineIndex;\n            for (var _i = 0, rawEvents_1 = rawEvents; _i < rawEvents_1.length; _i++) {\n                var rawEvent = rawEvents_1[_i];\n                if (rawEvent.length === 0) {\n                    continue; // FIXME why? This should be a protocol error\n                }\n                var data = JSON.parse(rawEvent);\n                var err = this.onMessage(data);\n                if (err != null) {\n                    return err;\n                }\n            }\n        }\n    };\n    // calls options.onEvent 0+ times, then returns an Error or null\n    Subscription.prototype.onMessage = function (message) {\n        this.assertState(['OPEN']);\n        if (this.gotEOS) {\n            return new Error(\"Got another message after EOS message\");\n        }\n        if (!Array.isArray(message)) {\n            return new Error(\"Message is not an array\");\n        }\n        if (message.length < 1) {\n            return new Error(\"Message is empty array\");\n        }\n        switch (message[0]) {\n            case 0:\n                return null;\n            case 1:\n                return this.onEventMessage(message);\n            case 255:\n                return this.onEOSMessage(message);\n            default:\n                return new Error(\"Unknown Message: \" + JSON.stringify(message));\n        }\n    };\n    // EITHER calls options.onEvent, OR returns an error\n    Subscription.prototype.onEventMessage = function (eventMessage) {\n        this.assertState(['OPEN']);\n        if (eventMessage.length !== 4) {\n            return new Error(\"Event message has \" + eventMessage.length + \" elements (expected 4)\");\n        }\n        var _ = eventMessage[0], id = eventMessage[1], headers = eventMessage[2], body = eventMessage[3];\n        if (typeof id !== \"string\") {\n            return new Error(\"Invalid event ID in message: \" + JSON.stringify(eventMessage));\n        }\n        if (typeof headers !== \"object\" || Array.isArray(headers)) {\n            return new Error(\"Invalid event headers in message: \" + JSON.stringify(eventMessage));\n        }\n        if (this.options.onEvent) {\n            this.options.onEvent({ eventId: id, headers: headers, body: body });\n        }\n    };\n    // calls options.onEvent 0+ times, then possibly returns an error\n    Subscription.prototype.onEOSMessage = function (eosMessage) {\n        this.assertState(['OPEN']);\n        if (eosMessage.length !== 4) {\n            return new Error(\"EOS message has \" + eosMessage.length + \" elements (expected 4)\");\n        }\n        var _ = eosMessage[0], statusCode = eosMessage[1], headers = eosMessage[2], info = eosMessage[3];\n        if (typeof statusCode !== \"number\") {\n            return new Error(\"Invalid EOS Status Code\");\n        }\n        if (typeof headers !== \"object\" || Array.isArray(headers)) {\n            return new Error(\"Invalid EOS Headers\");\n        }\n        this.state = SubscriptionState.ENDING;\n    };\n    Subscription.prototype.unsubscribe = function (err) {\n        this.state = SubscriptionState.ENDED;\n        this.xhr.abort();\n        if (err) {\n            if (this.options.onError) {\n                this.options.onError(err);\n            }\n        }\n        else {\n            if (this.options.onEnd) {\n                this.options.onEnd();\n            }\n        }\n    };\n    return Subscription;\n}());\nexports.Subscription = Subscription;\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar subscription_1 = __webpack_require__(1);\nvar ResumableSubscriptionState;\n(function (ResumableSubscriptionState) {\n    ResumableSubscriptionState[ResumableSubscriptionState[\"UNOPENED\"] = 0] = \"UNOPENED\";\n    ResumableSubscriptionState[ResumableSubscriptionState[\"OPENING\"] = 1] = \"OPENING\";\n    ResumableSubscriptionState[ResumableSubscriptionState[\"OPEN\"] = 2] = \"OPEN\";\n    ResumableSubscriptionState[ResumableSubscriptionState[\"ENDING\"] = 3] = \"ENDING\";\n    ResumableSubscriptionState[ResumableSubscriptionState[\"ENDED\"] = 4] = \"ENDED\"; // called onEnd() or onError(err)\n})(ResumableSubscriptionState = exports.ResumableSubscriptionState || (exports.ResumableSubscriptionState = {}));\n// Asserts that the subscription state is one of the specified values,\n// otherwise logs the current value.\nfunction assertState(stateEnum, states) {\n    var _this = this;\n    if (states === void 0) { states = []; }\n    var check = states.some(function (state) { return stateEnum[state] === _this.state; });\n    var expected = states.join(', ');\n    var actual = stateEnum[this.state];\n    console.assert(check, \"Expected this.state to be \" + expected + \" but it is \" + actual);\n    if (!check) {\n        console.trace();\n    }\n}\nexports.assertState = assertState;\n;\n// pattern of callbacks: ((onOpening (onOpen onEvent*)?)? (onError|onEnd)) | onError\nvar ResumableSubscription = (function () {\n    function ResumableSubscription(xhrSource, options) {\n        this.xhrSource = xhrSource;\n        this.options = options;\n        this.state = ResumableSubscriptionState.UNOPENED;\n        this.delayMillis = 0;\n        this.assertState = assertState.bind(this, ResumableSubscriptionState);\n        this.lastEventIdReceived = options.lastEventId;\n    }\n    ResumableSubscription.prototype.tryNow = function () {\n        var _this = this;\n        this.state = ResumableSubscriptionState.OPENING;\n        var newXhr = this.xhrSource();\n        this.subscription = new subscription_1.Subscription(newXhr, {\n            path: this.options.path,\n            lastEventId: this.lastEventIdReceived,\n            onOpen: function () {\n                _this.assertState(['OPENING']);\n                _this.state = ResumableSubscriptionState.OPEN;\n                if (_this.options.onOpen) {\n                    _this.options.onOpen();\n                }\n            },\n            onEvent: function (event) {\n                _this.assertState(['OPEN']);\n                if (_this.options.onEvent) {\n                    _this.options.onEvent(event);\n                }\n                console.assert(!_this.lastEventIdReceived ||\n                    parseInt(event.eventId) > parseInt(_this.lastEventIdReceived), 'Expected the current event id to be larger than the previous one');\n                _this.lastEventIdReceived = event.eventId;\n            },\n            onEnd: function () {\n                _this.state = ResumableSubscriptionState.ENDED;\n                if (_this.options.onEnd) {\n                    _this.options.onEnd();\n                }\n            },\n            onError: function (error) {\n                if (_this.isResumableError(error)) {\n                    _this.state = ResumableSubscriptionState.OPENING;\n                    if (_this.options.onOpening) {\n                        _this.options.onOpening();\n                    }\n                    _this.backoff();\n                }\n                else {\n                    _this.state = ResumableSubscriptionState.ENDED;\n                    if (_this.options.onError) {\n                        _this.options.onError(error);\n                    }\n                }\n            },\n        });\n        if (this.options.authorizer) {\n            this.options.authorizer.authorize().then(function (jwt) {\n                _this.subscription.open(jwt);\n            }).catch(function (err) {\n                // This is a resumable error?\n                console.log(\"Error getting auth token; backing off\");\n                _this.backoff();\n            });\n        }\n        else {\n            this.subscription.open(null);\n        }\n    };\n    ResumableSubscription.prototype.backoff = function () {\n        var _this = this;\n        this.delayMillis = this.delayMillis * 2 + 1000;\n        console.log(\"Trying reconnect in \" + this.delayMillis + \" ms.\");\n        window.setTimeout(function () { _this.tryNow(); }, this.delayMillis);\n    };\n    ResumableSubscription.prototype.open = function () {\n        this.tryNow();\n    };\n    ResumableSubscription.prototype.isResumableError = function (error) {\n        return error.message === \"resumable\"; // TODO this is a horrible way to represent resumableness\n    };\n    ResumableSubscription.prototype.unsubscribe = function () {\n        this.subscription.unsubscribe(); // We'll get onEnd and bubble this up\n    };\n    return ResumableSubscription;\n}());\nexports.ResumableSubscription = ResumableSubscription;\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_client_1 = __webpack_require__(0);\nvar DEFAULT_CLUSTER = \"api-ceres.kube.pusherplatform.io\";\nvar App = (function () {\n    function App(options) {\n        this.serviceId = options.serviceId;\n        this.authorizer = options.authorizer;\n        this.client = options.client || new base_client_1.BaseClient({\n            cluster: options.cluster || DEFAULT_CLUSTER,\n            encrypted: options.encrypted\n        });\n    }\n    App.prototype.request = function (options) {\n        var _this = this;\n        options.path = this.absPath(options.path);\n        var authorizer = options.authorizer || this.authorizer;\n        if (!options.jwt && authorizer) {\n            return authorizer.authorize().then(function (jwt) {\n                return _this.client.request(__assign({ jwt: jwt }, options));\n            });\n        }\n        else {\n            return this.client.request(options);\n        }\n    };\n    App.prototype.subscribe = function (options) {\n        options.path = this.absPath(options.path);\n        var subscription = this.client.newSubscription(options);\n        var authorizer = options.authorizer || this.authorizer;\n        if (options.jwt) {\n            subscription.open(options.jwt);\n        }\n        else if (authorizer) {\n            authorizer.authorize().then(function (jwt) {\n                subscription.open(jwt);\n            }).catch(function (err) {\n                subscription.unsubscribe(err);\n            });\n        }\n        else {\n            subscription.open(null);\n        }\n        return subscription;\n    };\n    App.prototype.resumableSubscribe = function (options) {\n        options.path = this.absPath(options.path);\n        var authorizer = options.authorizer || this.authorizer;\n        var resumableSubscription = this.client.newResumableSubscription(__assign({ authorizer: authorizer }, options));\n        resumableSubscription.open();\n        return resumableSubscription;\n    };\n    App.prototype.absPath = function (relativePath) {\n        return (\"/apps/\" + this.serviceId + \"/\" + relativePath).replace(/\\/+/g, \"/\").replace(/\\/+$/, \"\");\n    };\n    return App;\n}());\nexports.default = App;\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar app_1 = __webpack_require__(3);\nvar base_client_1 = __webpack_require__(0);\nvar resumable_subscription_1 = __webpack_require__(2);\nvar subscription_1 = __webpack_require__(1);\nexports.default = {\n    App: app_1.default,\n    BaseClient: base_client_1.BaseClient,\n    ResumableSubscription: resumable_subscription_1.ResumableSubscription,\n    Subscription: subscription_1.Subscription\n};\n\n\n/***/ })\n/******/ ]);\n});","export const servicePath = \"services/feeds/v1/\";\nexport const feedIdRegex = /^[a-zA-Z0-9-]+$/;\nexport const serviceIdRegex = /^[a-zA-Z0-9-]+$/;\nexport const cacheExpiryTolerance = 60;\nexport const defaultAuthEndpoint = \"/feeds/tokens\";\n","export function parseResponse(promise) {\n  return new Promise((resolve, reject) => {\n    promise.then(response => {\n      try {\n        resolve(JSON.parse(response));\n      } catch (err) {\n        reject(err);\n      }\n    }).catch(reject);\n  });\n}\n\nexport function urlEncode(data) {\n  return Object.keys(data)\n    .filter(key => data[key] !== undefined)\n    .map(key => `${ key }=${ encodeURIComponent(data[key]) }`)\n    .join(\"&\");\n}\n\nexport function queryString(data) {\n  const encodedData = urlEncode(data);\n  return encodedData ? `?${ encodedData }` : \"\";\n}\n","import { servicePath } from \"./constants\";\nimport { parseResponse, queryString } from \"./utils\";\n\nexport default class Feed {\n  constructor({ app, feedId, readAuthorizer }) {\n    this.app = app;\n    this.feedId = feedId;\n    this.readAuthorizer = readAuthorizer;\n  }\n\n  subscribe(options = {}) {\n    return this.app.resumableSubscribe({\n      ...options,\n      path: this.itemsPath + queryString({\n        tail_size: options.tailSize,\n      }),\n      authorizer: this.readAuthorizer,\n      onEvent: options.onItem,\n    });\n  }\n\n  getHistory({ fromId, limit = 50 } = {}) {\n    return parseResponse(this.app.request({\n      method: \"GET\",\n      path: this.itemsPath + queryString({\n        from_id: fromId,\n        limit: limit,\n      }),\n      authorizer: this.readAuthorizer,\n    }));\n  }\n\n  get itemsPath() {\n    return `${ servicePath }/feeds/${ this.feedId }/items`;\n  }\n}\n","import { cacheExpiryTolerance, defaultAuthEndpoint } from \"./constants\";\nimport { urlEncode } from \"./utils\";\n\nfunction now() {\n  return Math.floor(Date.now() / 1000);\n}\n\nexport default class FeedsAuthorizer {\n  constructor({ authEndpoint, authData }) {\n    this.authEndpoint = authEndpoint || defaultAuthEndpoint;\n    this.authData = authData;\n  }\n\n  authorize() {\n    if (this.cacheIsStale) {\n      return this.makeAuthRequest().then(responseBody => {\n        this.cache(responseBody.access_token, responseBody.expires_in);\n        return this.cachedToken;\n      });\n    }\n    return Promise.resolve(this.cachedToken);\n  }\n\n  get cacheIsStale() {\n    return !this.cachedToken || now() > this.cacheValidUntil;\n  }\n\n  cache(token, expiresIn) {\n    this.cachedToken = token;\n    this.cacheValidUntil = now() + expiresIn - cacheExpiryTolerance;\n  }\n\n  makeAuthRequest() {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open(\"POST\", this.authEndpoint);\n      xhr.addEventListener(\"load\", () => {\n        if (xhr.status === 200) {\n          resolve(JSON.parse(xhr.responseText));\n        } else {\n          // TODO make sure this error gets bubbled up from the platform library\n          reject(new Error(`Couldn't get token from ${ this.authEndpoint }; got ${ xhr.status } ${ xhr.statusText }.`));\n        }\n      });\n      xhr.setRequestHeader(\"content-type\", \"application/x-www-form-urlencoded\");\n      xhr.send(urlEncode({\n        ...this.authData,\n        grant_type: \"client_credentials\",\n      }));\n    });\n  }\n}\n","import PusherPlatform from \"pusher-platform-js\";\nimport Feed from \"./feed\";\nimport FeedsAuthorizer from \"./feeds-authorizer\";\nimport { servicePath, feedIdRegex, serviceIdRegex } from \"./constants\";\nimport { parseResponse, queryString } from \"./utils\";\n\nexport default class PusherFeeds {\n  constructor({ serviceId, cluster, authData = {}, authEndpoint } = {}) {\n    this.authData = authData;\n    this.authEndpoint = authEndpoint;\n    if (!serviceId || !serviceId.match(serviceIdRegex)) {\n      throw new TypeError(`Invalid serviceId: ${ serviceId }`);\n    }\n    this.listAuthorizer = new FeedsAuthorizer({\n      authEndpoint: this.authEndpoint,\n      authData: {\n        ...this.authData,\n        path: \"feeds\",\n        action: \"READ\",\n      }\n    });\n    this.firehoseAuthorizer = new FeedsAuthorizer({\n      authEndpoint: this.authEndpoint,\n      authData: {\n        ...this.authData,\n        path: \"firehose/items\",\n        action: \"READ\",\n      }\n    });\n    this.app = new PusherPlatform.App({ serviceId, cluster });\n  }\n\n  list({ prefix, limit } = {}) {\n    return parseResponse(this.app.request({\n      method: \"GET\",\n      path: `${ servicePath }/feeds` + queryString({ prefix, limit }),\n      authorizer: this.listAuthorizer,\n    }));\n  }\n\n  feed(feedId) {\n    if (!feedId || !feedId.match(feedIdRegex)) {\n      throw new TypeError(`Invalid feedId: ${ feedId }`);\n    }\n    const readAuthorizer = feedId.startsWith(\"private-\") ? new FeedsAuthorizer({\n      authEndpoint:  this.authEndpoint,\n      authData: {\n        ...this.authData,\n        path: `feeds/${ feedId }/items`,\n        action: \"READ\",\n      }\n    }) : null;\n    return new Feed({\n      app: this.app,\n      feedId,\n      readAuthorizer,\n    });\n  }\n\n  firehose(options) {\n    // TODO wrap onEvent to expose onPublish, onSubscribe, and onUnsubscribe\n    return this.app.subscribe({\n      ...options,\n      path: `${ servicePath }/firehose/items`,\n      authorizer: this.firehoseAuthorizer,\n    });\n  }\n}\n"],"names":["webpackUniversalModuleDefinition","root","factory","module","this","modules","installedModules","__webpack_require__","moduleId","exports","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","getDefault","getModuleExports","object","property","prototype","hasOwnProperty","p","s","subscription_1","resumable_subscription_1","responseHeadersObj","headerStr","headers","headerPairs","split","length","headerPair","index","indexOf","key","substring","val","ErrorResponse","xhr","statusCode","status","getAllResponseHeaders","info","responseText","XhrReadyState","BaseClient","options","cluster","replace","baseURL","encrypted","XMLHttpRequest","window","request","createXHR","Promise","resolve","reject","onreadystatechange","readyState","send","JSON","stringify","body","newSubscription","subOptions","Subscription","path","newResumableSubscription","_this","ResumableSubscription","endpoint","open","method","toUpperCase","setRequestHeader","jwt","base_client_1","SubscriptionState","assertState","stateEnum","states","check","some","state","expected","join","actual","assert","trace","UNOPENED","gotEOS","lastNewlineIndex","bind","lastEventId","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","OPENING","OPEN","onOpen","err","onChunk","abort","ENDED","onError","DONE","undefined","ENDING","Error","onEnd","onerror","response","newlineIndex","lastIndexOf","rawEvents","slice","_i","rawEvents_1","rawEvent","data","parse","onMessage","message","Array","isArray","onEventMessage","onEOSMessage","eventMessage","_","id","onEvent","eventId","eosMessage","unsubscribe","ResumableSubscriptionState","xhrSource","delayMillis","lastEventIdReceived","tryNow","newXhr","subscription","event","parseInt","error","isResumableError","onOpening","backoff","authorizer","authorize","then","catch","log","setTimeout","__assign","assign","t","arguments","DEFAULT_CLUSTER","App","serviceId","client","absPath","subscribe","resumableSubscribe","resumableSubscription","relativePath","default","app_1","servicePath","feedIdRegex","serviceIdRegex","cacheExpiryTolerance","defaultAuthEndpoint","parseResponse","promise","urlEncode","keys","filter","map","encodeURIComponent","queryString","encodedData","Feed","app","feedId","readAuthorizer","itemsPath","tailSize","onItem","fromId","limit","now","Math","floor","Date","FeedsAuthorizer","authEndpoint","authData","cacheIsStale","makeAuthRequest","cache","responseBody","access_token","expires_in","cachedToken","token","expiresIn","cacheValidUntil","addEventListener","statusText","PusherFeeds","match","TypeError","listAuthorizer","firehoseAuthorizer","PusherPlatform","prefix","startsWith"],"mappings":"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"}