<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>1984 Notes</title>
  <script src="/pusher-feeds-client.js"></script>
  <script>
function publishToNewsfeed(oFormElement) {
  var xhr = new XMLHttpRequest();
  xhr.onload = function(){ console.log("published!"); }
  xhr.open ("POST", "/newsfeed", true);
  xhr.setRequestHeader("Content-Type", "application/json");
  xhr.send (JSON.stringify({"item_data": document.getElementById("newsfeed_data").value}));
  return false;
}

function publishToNotes(oFormElement) {
  var xhr = new XMLHttpRequest();
  xhr.onload = function(){ console.log("published!"); }
  xhr.open ("POST", "/notes/$USER_ID", true);
  xhr.setRequestHeader("Content-Type", "application/json");
  xhr.send (JSON.stringify({"item_data": document.getElementById("data").value}));
  return false;
}

const feeds = new PusherFeeds({
  appId: "auth-example-app",
  host: "api-staging-ceres.kube.pusherplatform.io"
});

feeds.subscribe("newsfeed", {tailSize: 10, onEvent: item => {
  const itemEl = document.createElement("li")
  itemEl.textContent = item.data;
  document.getElementById("newsfeed").prepend(itemEl);
}});

feeds.subscribe("private-$USER_ID", {tailSize: 10, onEvent: item => {
  const itemEl = document.createElement("li")
  itemEl.textContent = item.data;
  document.getElementById("notes").prepend(itemEl);
}});
</script>
</head>

<body>
  <div style="border-style: solid; width: 49%; float: left">
    <div>
      <input id="newsfeed_data" type="text" name="item_data">
      <br/>
      <button type="button" name="publishToNewsfeed" onclick="publishToNewsfeed(this)">Publish!</button>
    </div>
    <div>
      <ul id="newsfeed">
      </ul>
    </div>
  </div>
  <div style="border-style: solid; width: 49%; float: right">
    <div>
      <input id="data" type="text" name="item_data">
      <br/>
      <button type="button" name="publish" onclick="publishToNotes(this)">Publish!</button>
    </div>
    <div>
      <ul id="notes">
      </ul>
    </div>
  </div>
</body>
</html>
